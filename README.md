Постмортем инцидента GitHub (21–22 октября 2018 года)

Краткое описание инцидента
21 октября 2018 года в 22:52 UTC GitHub столкнулся с серьезным сбоем, который привел к ухудшению работы сервиса на 24 часа и 11 минут. Хотя часть платформы оставалась доступной, несколько внутренних систем были затронуты, что привело к отображению устаревших и несогласованных данных. Потери пользовательских данных не произошло, однако ручное восстановление нескольких секунд записи в базу данных все еще продолжается. В течение большей части инцидента GitHub также не мог обрабатывать вебхуки и публиковать сайты GitHub Pages.

Предыстория
Большинство пользовательских сервисов GitHub работают в наших собственных дата-центрах. Архитектура сети дата-центров разработана для обеспечения надежности и масштабируемости, с несколькими региональными дата-центрами, обеспечивающими вычислительные мощности и хранение данных. Однако даже при наличии избыточности возможны ситуации, когда связь между дата-центрами временно прерывается.

21 октября в 22:52 UTC плановые работы по замене неисправного оптического оборудования привели к потере связи между сетевым узлом на восточном побережье США и основным дата-центром в этом регионе. Связь была восстановлена через 43 секунды, но этот кратковременный сбой запустил цепочку событий, которая привела к длительному ухудшению работы сервиса.

Хронология инцидента

22:52 UTC: Потеря связи между дата-центрами. Orchestrator (инструмент для управления топологией MySQL) начал процесс переключения на резервный дата-центр на западном побережье США.

22:54 UTC: Системы мониторинга начали генерировать предупреждения о проблемах. Инженеры начали анализ ситуации.

23:07 UTC: Команда заблокировала внутренние инструменты развертывания, чтобы предотвратить дополнительные изменения.

23:13 UTC: Стало ясно, что проблема затрагивает несколько кластеров MySQL. Началось восстановление топологии репликации.

23:19 UTC: Было принято решение приостановить обработку вебхуков и сборку GitHub Pages, чтобы избежать потери данных.

22 октября 00:05 UTC: Началось восстановление данных из резервных копий.

06:51 UTC: Часть кластеров была восстановлена, но задержки репликации сохранялись.

11:12 UTC: Все первичные базы данных были восстановлены в дата-центре на восточном побережье. Однако реплики оставались отстающими, что приводило к несогласованности данных.

16:24 UTC: После синхронизации реплик была восстановлена исходная топология.

23:03 UTC: Все отложенные задачи (вебхуки и сборки GitHub Pages) были обработаны, статус сервиса изменен на "зеленый".

Причины инцидента
Основной причиной инцидента стало непредвиденное поведение Orchestrator, который переключил запись на дата-центр на западном побережье США после потери связи. Это привело к рассинхронизации данных между дата-центрами. Приложения GitHub не были рассчитаны на работу с такой топологией, что вызвало задержки и несогласованность данных.

Решение

Конфигурация Orchestrator: Необходимо изменить настройки Orchestrator, чтобы предотвратить переключение первичных баз данных между регионами.

Тестирование сценариев отказа: Ускорение внедрения инструментов для тестирования сценариев отказа, включая chaos engineering.

Активная/активная архитектура: Ускорение перехода на архитектуру с активной/активной поддержкой в нескольких дата-центрах, чтобы обеспечить отказоустойчивость на уровне объектов.

Улучшение коммуникации: Улучшение системы отчетности о статусе, чтобы предоставлять более точную информацию о состоянии сервисов.

